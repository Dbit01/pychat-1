FROM alpine:3.6
WORKDIR /usr/src
COPY ./chat  /usr/src/chat
COPY ./templates  /usr/src/templates
COPY ./docker/docker_settings.py  /usr/src/chat/production.py
COPY ./manage.py ./requirements.txt ./config.json ./DefaultSmilies.cfpack ./download_content.sh /usr/src/
RUN mkdir /usr/src/log &&\
apk update &&\
apk add python3 python3-dev mariadb-dev build-base sassc bash curl &&\
pip3 install -r requirements.txt &&\
apk del python3-dev mariadb-dev build-base &&\
apk add mariadb-client-libs &&\
ln -s `which python3` "$(dirname `which python3`)/python" &&\
bash download_content.sh all
