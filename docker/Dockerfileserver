FROM alpine:3.6
WORKDIR /usr/src
RUN mkdir ./log &&\
apk update &&\
apk add python3 python3-dev mariadb-dev build-base linux-headers pcre-dev sassc bash curl &&\
pip3 install mysqlclient &&\
pip3 install uwsgi &&\
apk del python3-dev mariadb-dev build-base linux-headers &&\
apk add mariadb-client-libs &&\
ln -s `which python3` "$(dirname `which python3`)/python"
COPY ./requirements.txt .
RUN pip3 install -r requirements.txt
COPY ./docker/production_db.py ./manage.py ./config.json ./DefaultSmilies.cfpack ./docker/chat-uwsgi.ini ./download_content.sh ./
COPY ./chat ./chat/production.py ./chat/
COPY ./templates  ./templates
RUN cat ./production_db.py >> ./chat/production.py && bash download_content.sh all