{% extends 'story/base.html' %}
{% block head %}
	{% load staticfiles %}
	{% if not readonly %}
	<script>
	// TODO move it into a separate file
		document.addEventListener("DOMContentLoaded", function () {
			if (isDateMissing()) {
				console.warn(getDebugMessage("Browser doesn't support html5 input type date, trying to load javascript datepicker"));
				loadjscssfile("{% static 'css/pikaday.css' %}", 'css');
				loadjscssfile("{%  static 'js/moment.js' %}", 'js', function () {
					// load pikaday only after moment.js
					loadjscssfile("{% static 'js/pikaday.js' %}", 'js', function () {
						var picker = new Pikaday(
								{
									field: document.getElementById('id_birthday'),
									format: '{{ date_format }}',
									firstDay: 1,
									maxDate: new Date(),
									yearRange: [1930, 2010]
								});
						console.log(getDebugMessage("pikaday date picker has been loaded"));
					});
				})
			}
		});
	</script>
	{% endif %}
{% endblock head %}
{% block content %}
	<div >
		{#	if photo isn't uploaded yet #}
		{% if form.instance.photo %}
			<div class="col1">
				<div class="padding10">
					<img src="{{ form.instance.photo.url }}" alt="ava" class="fullwidth">
				</div>
			</div>
		{% endif %}

	{% if not readonly %}
		<form  class="col1" action="{% url 'story.views.save_profile' %}" method="post" enctype="multipart/form-data">
			{% csrf_token %}
			<table class="biginputtext">
				{{ form.as_table }}
				<tr>
					<td colspan="2"><input type="submit" value="Save"/></td>
					{% comment %}<td colspan="2"><input type="button" value="ajax"/></td>{% endcomment %}
				</tr>
			</table>
		</form>
	{% else %}
		<div class="col1">
			<table class="biginputtext">
				{{ form.as_table }}
			</table>
		</div>
	{%  endif%}
	</div>
{% endblock content %}