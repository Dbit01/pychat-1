{% extends "base.html" %}
{% block head %} {% load md5url %}
	<script>
		const API_URL = "{{ apiUrl }}";
		const PICKADAY_CSS_URL = "{% md5url 'css/pikaday.css' %}";
		const MOMENT_JS_URL = "{% md5url 'js/moment.js' %}";
		const PICKADAY_JS_URL = "{% md5url 'js/pikaday.js' %}";
		const AMCHART_URL = "{% md5url 'js/amcharts-all.js' %}";
		const CHANGE_PROFILE_JS_URL = "{% md5url 'js/webrtc.js' %}";
		const STATISTICS_JS_URL = "{% md5url "js/statistic.js" %}";
		const loggedUser = "{{ username }}";
		var suggestions = {{ suggestions |yesno:"true,false" }};
	</script>
	<script src="{% md5url "js/smileys_data.js" %}"></script>
	<script src="{% md5url "js/chat.js" %}"></script>
	<link rel="stylesheet" type="text/css" href="{% md5url 'css/chat.css' %}">
{% endblock head %}
{% block content %}
	<nav class="noSelection">
		<a class="icon-home" href="/" title="Go home" onclick="event.preventDefault(); singlePage.showPage('');"><span class="mText">home</span></a>
		<i id="muteBtn" class="icon-volume-off" title="Turn on or off sounds" onclick="mute();"><span class="mText">volume</span></i>
		<a href="/#/report_issue" class="icon-pencil very-small-screen" title="report an issue"
			onclick="event.preventDefault(); singlePage.showPage('/report_issue')"><span class="mText">issue</span></a>
		<i class="icon-clear" title="Clear local history" onclick="clearLocalHistory()"><span class="mText">clear</span></i>
		<a class="icon-phone" href="/#/call" title="Make a video/mic call" onclick="event.preventDefault(); webRtcApi.showCallDialog()"><span class="mText">Call</span></a>
		<a href="/#/statistics" class="icon-chart-pie" onclick="event.preventDefault(); singlePage.showPage('/statistics')" title="Show user countries statistics"><span class="mText">statistics</span></a>
		<span id='headerText' class="username very-small-screen flex-push-right"></span>
		<a  href="/#/profile" title="Settings" onclick="event.preventDefault(); singlePage.showPage('/profile')" class="icon-wrench"> <span class="mText">Profile</span></a>
		<a id="exit" rel="nofollow" href="{% url 'chat.views.logout' %}">
			<i title="Sign out" class="icon-sign-out"><span class="mText">sign out</span></i> </a>
	</nav>
	<div>
		<audio id="chatIncoming" src="{% md5url 'sounds/ChatIncoming.wav' %}" preload="none"></audio>
		<audio id="chatOutgoing" src="{% md5url 'sounds/ChatOutgoing.wav' %}" preload="none"></audio>
		<audio id="chatLogin" src="{% md5url 'sounds/ChatLogin.wav' %}" preload="none" ></audio>
		<audio id="chatLogout" src="{% md5url 'sounds/ChatLogout.wav' %}" preload="none"></audio>
		<audio id="chatCall" src="{% md5url 'sounds/Call.mp3' %}" preload="none"></audio>
	</div>
	<style>
		#userProfile label, #userProfile td {
			font-size: 20px;
		}
	@media screen and (max-height: 400px) {
		#userProfile label, #userProfile td {
			font-size: 12px;
		}
	}
	</style>
	<div id="window" class="modal-body hidden">
		<div id="windowHeader" class="noSelection windowHeader">
			<span></span>
			<i class="icon-cancel"></i>
		</div>
		<div id="windowBody"></div>
	</div>
	<div id="wrapper" class="max-height-scrollable hidden">
		<div id="chat-room-users-wrapper" class="very-small-screen">
			<ul id="user-context-menu" class="hidden">
				<li onclick="userTable.call()">Call</li>
				<li onclick="growlError('not implemented')">Transfer file</li>
				<li onclick="userTable.viewProfile()">View profile</li>
			</ul>
			<ul id="chat-user-table">
			</ul>
			<div>
				<span>#Channels <i class="icon-plus-squared" title="Create new channel" onclick="alert('not impl')"></i></span>
				<div id="rooms">
				</div>
			</div>
		</div>
		<div id="smileParentHolder" class="padding10 hidden" onclick="smileyUtil.addSmile(event);">
			<ul id="tabNames" onclick="smileyUtil.showTabByName(event)"></ul>
		</div>
	</div>
	<div id="userMessageWrapper" class="hidden" style="position: relative">
		<input type="file" accept="image/*" id="imgInput" class="hidden"/>
		<i class="icon-picture" title="Add a picture" onclick="$('imgInput').click()"></i>
		<i class="icon-smile" title="Add a smile :)" onclick="smileyUtil.toggleSmileys(event)"></i>
		<div contenteditable="true" id="usermsg" onkeydown="chatHandler.checkAndSendMessage(event)"></div>
	{% comment %}TODO which chat variable to use?{% endcomment %}
	</div>
	<div id="callContainer" class="hidden">
		<div id="callContainerContent">
			<div id='videoContainer'>
				<video id="remoteVideo" autoplay></video>
				<video id="localVideo" autoplay muted></video>
				<div id="icon-webrtc-cont">
					<i id="fs-video"></i>
					<i id="fs-audio" ></i>
					<i id="fs-minimize" class="icon-webrtc-minimizedscreen" title="Exit fullscreen"></i>
					<i id="fs-hangup" class="icon-webrtc-hangup"></i>
				</div>
			</div>
			<ul id="callUserList">
			</ul>
			<div class="callContainerIcons noSelection">
				<i id="audioStatusIcon" class="icon-mic" ></i>
				<i id="videoStatusIcon" class="icon-videocam"></i>
				<div id="enterFullScreenHolder" >
					<i id="enterFullScreen" class="icon-webrtc-fullscreen" title="Fullscreen"></i>
				</div>
				<i class="icon-phone-circled" id="callIcon"></i>
				<i class="icon-hang-up finish-call-icon" id="hangUpIcon"></i>
				<img src="{% md5url 'images/call.gif' %}" alt="call" class="hidden" id="callRing" style="width: 30px"/>
			</div>
		</div>
	</div>
	<form method="post" id="issueForm" class="hidden">
		<table class="fullwidth padding10">
			<tr>
				<th><label for="issue">The problem you discovered</label></th>
				<td><textarea id="issue" aria-required="true" name="issue" required></textarea></td>
			</tr>
			<tr>
				<th><label for="version">Affected browser</label></th>
				<td><input type="text" name="browser" id="version"/></td>
			</tr>
			<tr>
				<th>
					<label for="history">Send Lfogs</label>
				</th>
				<td><input type="checkbox" name="history" id="history" checked/></td>
			<tr>
				<td colspan="2"><input type="submit" value="Sumbit"></td>
			</tr>
		</table>
	</form>
	<div class="modal-background hidden" id="callAnswerParent">
		<div id="callAnswer" class="modal-body modal-fixed">
			<span id="callAnswerText">Somebody is calling you</span>
			<div class="answerButtons">
				<button onclick="webRtcApi.answerWebRtcCall()" class="green-btn">
					<i class="icon-call-aswer"></i> <div>Answer</div>
				</button>
				<button onclick="webRtcApi.videoAnswerWebRtcCall()" class="green-btn">
					<i class="icon-videocam"></i> <div>Answer with video</div>
				</button>
				<button onclick="webRtcApi.declineWebRtcCall()" class="red-btn">
					<i class="icon-hang-up"></i> <div>Decline</div>
				</button>
			</div>
		</div>
	</div>
{% endblock %}
