{% extends "base.html" %}
{% block head %} {% load md5url %}
	<script>
		const API_URL = "{{ apiUrl }}";
		const SMILEYS_JSON_URL = "{% md5url 'smileys/info.json'  %}";
		const SMILEY_URL = "{% md5url "smileys/" %}";
	</script>
	<script src="{% md5url "js/chat.js" %}"></script>
	<link rel="stylesheet" type="text/css" href="{% md5url 'css/chat.css' %}">
	<script>
		const loggedUser = "{{ username }}";
	</script>
{% endblock head %}
{% block navbar %}
	<i class="icon-clear" title="Clear local history" onclick="clearLocalHistory()"><span class="mText">clear</span></i>
	<i class="icon-phone" title="Make a video/mic call" onclick="webRtcApi.showCallDialog()"><span class="mText">Call</span></i>
{% endblock navbar %}
{% block content %}
	<div>
		<audio id="chatIncoming" src="{% md5url 'sounds/ChatIncoming.wav' %}" preload="none"></audio>
		<audio id="chatOutgoing" src="{% md5url 'sounds/ChatOutgoing.wav' %}" preload="none"></audio>
		<audio id="chatLogin" src="{% md5url 'sounds/ChatLogin.wav' %}" preload="none" ></audio>
		<audio id="chatLogout" src="{% md5url 'sounds/ChatLogout.wav' %}" preload="none"></audio>
		<audio id="chatCall" src="{% md5url 'sounds/Call.mp3' %}" preload="none"></audio>
	</div>
	<div id="wrapper" class="max-height-scrollable" style="position: relative">
		<div id="chatbox" tabindex="0" onkeydown="keyDownLoadUp(event)">
			<div>
			</div>
		</div>{% comment %}tabindex allows focus, focus allows keydown binding event{% endcomment %}
		<div id="chat-room-users-wrapper" class="very-small-screen">
			<table id="chat-user-table">
				<tr></tr>
			</table>
			<div>
				<span>#Channels <i class="icon-plus-squared" title="Create new channel" onclick="alert('not impl')"></i></span>
				<div id="rooms">
				</div>
			</div>
		</div>
		<div id="smileParentHolder" class="padding10 hidden" onclick="smileyUtil.addSmile(event);">
			<ul id="tabNames" onclick="smileyUtil.showTabByName(event)"></ul>
		</div>
	</div>
	<div class="fullwidth-padded box-shadow" style="position: relative">
		<div id="userSendMessageTo" class="hidden">
			<div id="receiverId"></div>
			<i class="icon-cancel" onclick="hideUserSendToName();"></i>
		</div>
		<i class="icon-smile" title="Add a smile :)" onclick="smileyUtil.toggleSmileys(event)"></i>
		<div contenteditable="true" id="usermsg" onkeydown="checkAndSendMessage(event)"></div>
	</div>
	<div id="callContainer" class="modal-body modal-draggable hidden">
		<div id="callContainerHeader" class="noSelection">
			<span id="callContainerHeaderText" style="display: inline-block"></span>
			<i class="icon-cancel" style="float: right; color: rgb(177, 53, 51);"
				onclick="webRtcApi.closeDialog()"></i>
		</div>
		<div id="callContainerContent">
			<div id='videoContainer'>
				<video id="remoteVideo" autoplay></video>
				<video id="localVideo" autoplay muted></video>
				<div id="icon-webrtc-cont">
					<i id="fs-video"></i>
					<i id="fs-audio" ></i>
					<i id="fs-minimize" class="icon-webrtc-minimizedscreen" title="Exit fullscreen"></i>
					<i id="fs-hangup" class="icon-webrtc-hangup"></i>
				</div>
			</div>
			<ul id="callUserList">
			</ul>
			<div class="callContainerIcons noSelection">
				<i id="audioStatusIcon" class="icon-mic" ></i>
				<i id="videoStatusIcon" class="icon-videocam"></i>
				<div id="enterFullScreenHolder" >
					<i id="enterFullScreen" class="icon-webrtc-fullscreen" title="Fullscreen"></i>
				</div>
				<i class="icon-phone-circled" id="callIcon"></i>
				<i class="icon-hang-up finish-call-icon" id="hangUpIcon"></i>
				<img src="{% md5url 'images/call.gif' %}" alt="call" class="hidden" id="callRing" style="width: 30px"/>
			</div>
		</div>
	</div>
	<div class="modal-background hidden" id="callAnswerParent">
		<div id="callAnswer" class="modal-body modal-fixed">
			<span id="callAnswerText">Somebody is calling you</span>
			<div class="answerButtons">
				<button onclick="webRtcApi.answerWebRtcCall()" class="green-btn">
					<i class="icon-call-aswer"></i> <div>Answer</div>
				</button>
				<button onclick="webRtcApi.videoAnswerWebRtcCall()" class="green-btn">
					<i class="icon-videocam"></i> <div>Answer with video</div>
				</button>
				<button onclick="webRtcApi.declineWebRtcCall()" class="red-btn">
					<i class="icon-hang-up"></i> <div>Decline</div>
				</button>
			</div>
		</div>
	</div>

{% endblock %}